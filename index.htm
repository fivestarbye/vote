<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>投票勇者大富翁</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f8ff;
      padding: 10px;
    }
    .board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(5, 1fr);
      max-width: 480px;
      margin: auto;
      gap: 2px;
      aspect-ratio: 1 / 1;
    }
    .tile {
      background: #fff;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px;
      position: relative;
      border-radius: 5px;
      text-align: center;
      word-break: break-word;
    }
    .tile.active {
      background-color: #ffecb3;
      font-weight: bold;
    }
    .hero-icon {
      position: absolute;
      top: 2px;
      left: 2px;
    }
    .info {
      margin-top: 1rem;
      font-size: 1rem;
    }
    #quiz-options button {
      margin: 5px;
      padding: 8px 12px;
      font-size: 1rem;
    }
    button {
      font-size: 1rem;
      margin: 8px;
      padding: 10px 20px;
      border-radius: 5px;
      border: none;
      background-color: #007bff;
      color: white;
    }
    button:disabled {
      background-color: #ccc;
    }
  </style>
</head>
<body>
  <h1>投票勇者大富翁</h1>
  <div class="board" id="board"></div>
  <div class="info" style="max-width: 480px; margin: auto;">
    <p id="location"></p>
    <p id="dice">🎲 點數：</p>
    <p id="event"></p>
    <p id="score">分數：0</p>
    <div id="quiz" style="display:none">
      <p id="quiz-question"></p>
      <div id="quiz-options"></div>
    </div>
    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
      <button id="rollBtn">擲骰子</button>
      <button id="restartBtn">重新開始</button>
    </div>
  </div>
<script>
// JavaScript 回復如下
const pathIndices = [0,1,2,3,4,9,14,19,24,23,22,21,20,15,10,5];
const tileMap = Array(25).fill("");

const taiwanLandmarks = [
  "新竹城隍廟", "桃園機場", "台南赤崁樓", "高雄85大樓",
  "阿里山車站", "墾丁大街", "玉山國家公園", "日月潭碼頭",
  "清境農場", "宜蘭傳藝中心", "太魯閣峽谷", "綠島燈塔",
  "澎湖跨海大橋", "烏來瀑布"
];

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function initializeTileNames() {
  const fixed = ["起點", "基隆港", "陽明山", "大稻埕", "台北101", "中正紀念堂", "淡水老街", "台中公園", "鹿港老街", "投票所"];
  const shuffled = shuffle(taiwanLandmarks.slice());
  return fixed.slice(0, 6).concat(shuffled.slice(0, 9), fixed.slice(6));
}

let tileNames = initializeTileNames();
let pos = 0;
let score = 0;
let usedQuizzes = new Set();

function assignTiles() {
  tileNames = initializeTileNames();
  pathIndices.forEach((idx, i) => {
    tileMap[idx] = tileNames[i] || `地點${i}`;
  });
}

const events = [
  { name: "遇到冷漠路人", effect: -2 },
  { name: "假消息干擾", effect: -1 },
  { name: "好朋友同行", effect: +2 },
  { name: "撿到身分證", effect: +3 },
  { name: "空地休息", effect: 0 },
  { name: "知識挑戰", effect: "quiz" }
];

const quizQuestions = [
  { q: "罷免案需經多少人同意才能通過？", a: ["選舉人總數1/2以上", "投票人1/2以上", "有效票過半數且達總數1/4"], c: 2 },
  { q: "哪個單位負責辦理罷免投票？", a: ["內政部", "中央選舉委員會", "立法院"], c: 1 }
];

function drawBoard() {
  const board = document.getElementById("board");
  board.innerHTML = "";
  for (let i = 0; i < 25; i++) {
    const tile = document.createElement("div");
    tile.className = "tile";
    if (tileMap[i] === "") tile.style.visibility = "hidden";
    if (i === pathIndices[pos]) tile.classList.add("active");
    tile.textContent = tileMap[i];
    if (i === pathIndices[pos]) {
      const hero = document.createElement("div");
      hero.className = "hero-icon";
      hero.textContent = "🧍";
      tile.appendChild(hero);
    }
    board.appendChild(tile);
  }
  document.getElementById("location").textContent = `目前地點：${tileMap[pathIndices[pos]]}`;
}

function randomEvent() {
  const quiz = quizQuestions.filter((_, i) => !usedQuizzes.has(i));
  if (quiz.length === 0) return;
  const rand = Math.floor(Math.random() * quiz.length);
  const index = quizQuestions.indexOf(quiz[rand]);
  usedQuizzes.add(index);
  document.getElementById("quiz").style.display = "block";
  document.getElementById("quiz-question").textContent = quiz[rand].q;
  const options = document.getElementById("quiz-options");
  options.innerHTML = "";
  quiz[rand].a.forEach((text, i) => {
    const btn = document.createElement("button");
    btn.textContent = text;
    btn.style.backgroundColor = '#28a745'; // 綠色區分
    btn.style.color = 'white';
    btn.style.border = 'none';
    btn.style.borderRadius = '4px';
    btn.style.padding = '8px 12px';
    btn.style.margin = '5px';
    btn.onclick = () => {
      const effectText = document.createElement("div");
      effectText.style.fontSize = "1.2rem";
      effectText.style.fontWeight = "bold";
      effectText.style.marginTop = "10px";
      if (i === quiz[rand].c) {
        score += 10;
        document.getElementById("event").textContent = "答對了！加10分";
        effectText.textContent = "✨ 正確！加分 ✨";
        effectText.style.color = "green";
      } else {
        score -= 5;
        document.getElementById("event").textContent = "答錯了！扣5分";
        effectText.textContent = "❌ 錯誤！扣分 ❌";
        effectText.style.color = "red";
      }
      document.getElementById("score").textContent = `分數：${score}`;
      document.getElementById("quiz").appendChild(effectText);
      setTimeout(() => {
        document.getElementById("quiz").style.display = "none";
        effectText.remove();
      }, 1500);
    };
    options.appendChild(btn);
  });
}

function handleEvent() {
  const event = events[Math.floor(Math.random() * events.length)];
  if (event.effect === "quiz") {
    randomEvent();
  } else {
    score += event.effect;
    document.getElementById("event").textContent = event.name +
      (event.effect === 0 ? "（沒有得失）" :
      (event.effect > 0 ? `，獲得${event.effect}分` : `，失去${-event.effect}分`));
    document.getElementById("score").textContent = `分數：${score}`;
  }
}

function rollDice() {
  const roll = Math.floor(Math.random() * 6) + 1;
  let steps = 0;
  const interval = setInterval(() => {
    pos = (pos + 1) % pathIndices.length;
    drawBoard();
    steps++;
    if (steps >= roll) {
      clearInterval(interval);
      document.getElementById("dice").textContent = `🎲 點數：${roll}`;
      const currentTile = tileMap[pathIndices[pos]];
      if (currentTile === "投票所") {
        document.getElementById("event").textContent = "到達投票所！遊戲結束";
        document.getElementById("rollBtn").disabled = true;
      } else {
        handleEvent();
      }
    }
  }, 200);
}

document.getElementById("rollBtn").onclick = rollDice;
document.getElementById("restartBtn").onclick = restartGame;

function restartGame() {
  pos = 0;
  score = 0;
  usedQuizzes.clear();
  document.getElementById("dice").textContent = "🎲 點數：";
  document.getElementById("score").textContent = "分數：0";
  document.getElementById("event").textContent = "";
  document.getElementById("quiz").style.display = "none";
  document.getElementById("rollBtn").disabled = false;
  assignTiles();
  drawBoard();
}

assignTiles();
drawBoard();
</script>
</body>
</html>
