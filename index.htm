<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æŠ•ç¥¨å‹‡è€…å¤§å¯Œç¿</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f8ff;
      padding: 10px;
    }
    .board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(5, 1fr);
      max-width: 480px;
      margin: auto;
      gap: 2px;
      aspect-ratio: 1 / 1;
    }
    .tile {
      background: #fff;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px;
      position: relative;
      border-radius: 5px;
      text-align: center;
      word-break: break-word;
    }
    .tile.active {
      background-color: #ffecb3;
      font-weight: bold;
    }
    .hero-icon {
      position: absolute;
      top: 2px;
      left: 2px;
    }
    .info {
      margin-top: 1rem;
      font-size: 1rem;
    }
    #quiz-options button {
      margin: 5px;
      padding: 8px 12px;
      font-size: 1rem;
    }
    button {
      font-size: 1rem;
      margin: 8px;
      padding: 10px 20px;
      border-radius: 5px;
      border: none;
      background-color: #007bff;
      color: white;
    }
    button:disabled {
      background-color: #ccc;
    }
  </style>
</head>
<body>
  <h1>æŠ•ç¥¨å‹‡è€…å¤§å¯Œç¿</h1>
  <div class="board" id="board"></div>
  <div class="info" style="max-width: 480px; margin: auto;">
    <p id="location"></p>
    <p id="dice">ğŸ² é»æ•¸ï¼š</p>
    <p id="event"></p>
    <p id="score">åˆ†æ•¸ï¼š0</p>
    <div id="quiz" style="display:none">
      <p id="quiz-question"></p>
      <div id="quiz-options"></div>
    </div>
    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
      <button id="rollBtn">æ“²éª°å­</button>
      <button id="restartBtn">é‡æ–°é–‹å§‹</button>
    </div>
  </div>
<script>
// JavaScript å›å¾©å¦‚ä¸‹
const pathIndices = [0,1,2,3,4,9,14,19,24,23,22,21,20,15,10,5];
const tileMap = Array(25).fill("");

const taiwanLandmarks = [
  "æ–°ç«¹åŸéšå»Ÿ", "æ¡ƒåœ’æ©Ÿå ´", "å°å—èµ¤å´æ¨“", "é«˜é›„85å¤§æ¨“",
  "é˜¿é‡Œå±±è»Šç«™", "å¢¾ä¸å¤§è¡—", "ç‰å±±åœ‹å®¶å…¬åœ’", "æ—¥æœˆæ½­ç¢¼é ­",
  "æ¸…å¢ƒè¾²å ´", "å®œè˜­å‚³è—ä¸­å¿ƒ", "å¤ªé­¯é–£å³½è°·", "ç¶ å³¶ç‡ˆå¡”",
  "æ¾æ¹–è·¨æµ·å¤§æ©‹", "çƒä¾†ç€‘å¸ƒ"
];

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function initializeTileNames() {
  const fixed = ["èµ·é»", "åŸºéš†æ¸¯", "é™½æ˜å±±", "å¤§ç¨»åŸ•", "å°åŒ—101", "ä¸­æ­£ç´€å¿µå ‚", "æ·¡æ°´è€è¡—", "å°ä¸­å…¬åœ’", "é¹¿æ¸¯è€è¡—", "æŠ•ç¥¨æ‰€"];
  const shuffled = shuffle(taiwanLandmarks.slice());
  return fixed.slice(0, 6).concat(shuffled.slice(0, 9), fixed.slice(6));
}

let tileNames = initializeTileNames();
let pos = 0;
let score = 0;
let usedQuizzes = new Set();

function assignTiles() {
  tileNames = initializeTileNames();
  pathIndices.forEach((idx, i) => {
    tileMap[idx] = tileNames[i] || `åœ°é»${i}`;
  });
}

const events = [
  { name: "é‡åˆ°å†·æ¼ è·¯äºº", effect: -2 },
  { name: "å‡æ¶ˆæ¯å¹²æ“¾", effect: -1 },
  { name: "å¥½æœ‹å‹åŒè¡Œ", effect: +2 },
  { name: "æ’¿åˆ°èº«åˆ†è­‰", effect: +3 },
  { name: "ç©ºåœ°ä¼‘æ¯", effect: 0 },
  { name: "çŸ¥è­˜æŒ‘æˆ°", effect: "quiz" }
];

const quizQuestions = [
  { q: "ç½·å…æ¡ˆéœ€ç¶“å¤šå°‘äººåŒæ„æ‰èƒ½é€šéï¼Ÿ", a: ["é¸èˆ‰äººç¸½æ•¸1/2ä»¥ä¸Š", "æŠ•ç¥¨äºº1/2ä»¥ä¸Š", "æœ‰æ•ˆç¥¨éåŠæ•¸ä¸”é”ç¸½æ•¸1/4"], c: 2 },
  { q: "å“ªå€‹å–®ä½è² è²¬è¾¦ç†ç½·å…æŠ•ç¥¨ï¼Ÿ", a: ["å…§æ”¿éƒ¨", "ä¸­å¤®é¸èˆ‰å§”å“¡æœƒ", "ç«‹æ³•é™¢"], c: 1 }
];

function drawBoard() {
  const board = document.getElementById("board");
  board.innerHTML = "";
  for (let i = 0; i < 25; i++) {
    const tile = document.createElement("div");
    tile.className = "tile";
    if (tileMap[i] === "") tile.style.visibility = "hidden";
    if (i === pathIndices[pos]) tile.classList.add("active");
    tile.textContent = tileMap[i];
    if (i === pathIndices[pos]) {
      const hero = document.createElement("div");
      hero.className = "hero-icon";
      hero.textContent = "ğŸ§";
      tile.appendChild(hero);
    }
    board.appendChild(tile);
  }
  document.getElementById("location").textContent = `ç›®å‰åœ°é»ï¼š${tileMap[pathIndices[pos]]}`;
}

function randomEvent() {
  const quiz = quizQuestions.filter((_, i) => !usedQuizzes.has(i));
  if (quiz.length === 0) return;
  const rand = Math.floor(Math.random() * quiz.length);
  const index = quizQuestions.indexOf(quiz[rand]);
  usedQuizzes.add(index);
  document.getElementById("quiz").style.display = "block";
  document.getElementById("quiz-question").textContent = quiz[rand].q;
  const options = document.getElementById("quiz-options");
  options.innerHTML = "";
  quiz[rand].a.forEach((text, i) => {
    const btn = document.createElement("button");
    btn.textContent = text;
    btn.style.backgroundColor = '#28a745'; // ç¶ è‰²å€åˆ†
    btn.style.color = 'white';
    btn.style.border = 'none';
    btn.style.borderRadius = '4px';
    btn.style.padding = '8px 12px';
    btn.style.margin = '5px';
    btn.onclick = () => {
      const effectText = document.createElement("div");
      effectText.style.fontSize = "1.2rem";
      effectText.style.fontWeight = "bold";
      effectText.style.marginTop = "10px";
      if (i === quiz[rand].c) {
        score += 10;
        document.getElementById("event").textContent = "ç­”å°äº†ï¼åŠ 10åˆ†";
        effectText.textContent = "âœ¨ æ­£ç¢ºï¼åŠ åˆ† âœ¨";
        effectText.style.color = "green";
      } else {
        score -= 5;
        document.getElementById("event").textContent = "ç­”éŒ¯äº†ï¼æ‰£5åˆ†";
        effectText.textContent = "âŒ éŒ¯èª¤ï¼æ‰£åˆ† âŒ";
        effectText.style.color = "red";
      }
      document.getElementById("score").textContent = `åˆ†æ•¸ï¼š${score}`;
      document.getElementById("quiz").appendChild(effectText);
      setTimeout(() => {
        document.getElementById("quiz").style.display = "none";
        effectText.remove();
      }, 1500);
    };
    options.appendChild(btn);
  });
}

function handleEvent() {
  const event = events[Math.floor(Math.random() * events.length)];
  if (event.effect === "quiz") {
    randomEvent();
  } else {
    score += event.effect;
    document.getElementById("event").textContent = event.name +
      (event.effect === 0 ? "ï¼ˆæ²’æœ‰å¾—å¤±ï¼‰" :
      (event.effect > 0 ? `ï¼Œç²å¾—${event.effect}åˆ†` : `ï¼Œå¤±å»${-event.effect}åˆ†`));
    document.getElementById("score").textContent = `åˆ†æ•¸ï¼š${score}`;
  }
}

function rollDice() {
  const roll = Math.floor(Math.random() * 6) + 1;
  let steps = 0;
  const interval = setInterval(() => {
    pos = (pos + 1) % pathIndices.length;
    drawBoard();
    steps++;
    if (steps >= roll) {
      clearInterval(interval);
      document.getElementById("dice").textContent = `ğŸ² é»æ•¸ï¼š${roll}`;
      const currentTile = tileMap[pathIndices[pos]];
      if (currentTile === "æŠ•ç¥¨æ‰€") {
        document.getElementById("event").textContent = "åˆ°é”æŠ•ç¥¨æ‰€ï¼éŠæˆ²çµæŸ";
        document.getElementById("rollBtn").disabled = true;
      } else {
        handleEvent();
      }
    }
  }, 200);
}

document.getElementById("rollBtn").onclick = rollDice;
document.getElementById("restartBtn").onclick = restartGame;

function restartGame() {
  pos = 0;
  score = 0;
  usedQuizzes.clear();
  document.getElementById("dice").textContent = "ğŸ² é»æ•¸ï¼š";
  document.getElementById("score").textContent = "åˆ†æ•¸ï¼š0";
  document.getElementById("event").textContent = "";
  document.getElementById("quiz").style.display = "none";
  document.getElementById("rollBtn").disabled = false;
  assignTiles();
  drawBoard();
}

assignTiles();
drawBoard();
</script>
</body>
</html>
